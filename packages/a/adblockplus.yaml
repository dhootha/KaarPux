package:
  name: adblockplus
  version: 2.6.6
  www: http://adblockplus.org/
  short: firefox plugin. Block annoying ads automatically.

download:
  url: http://adblockplus.org/downloads
  file: adblockplus-${KX_ADBLOCKPLUS_VERSION}-source.tgz
  checksum: b8edcfc7f0027cf1619fbb8c27cc34c8bbbc475d9a0deff2ef50bf2c78dd9317

version:
  sensitive: 1
  installed: kxver_mozilla_addon_installed "/opt/lib/mozilla/extensions/{d10d0bf8-f5b5-c8b4-a8b2-2b9879e08c5d}"
  upstream: kxver_upstream_mozilla_addon("adblock-plus");
  source: https://hg.adblockplus.org/adblockplus/

opt:
  - prepare_and_build:
    - echo: Unpacking
    - sh: |
        cd ${KX_BASE}/build/opt
        rm -rf "${KX_ADBLOCKPLUS}"
        mkdir -p "${KX_ADBLOCKPLUS}"
        cd "${KX_ADBLOCKPLUS}"
        echo EEE $(pwd) ${KX_BASE}/../downloads/${KX_ADBLOCKPLUS_FILE}
    - untar: $(pwd) ${KX_BASE}/../downloads/${KX_ADBLOCKPLUS_FILE}
    - echo: Patching
    - sh: sed -i 's/buildNum = int(value)/buildNum = value/' buildtools/build.py
    - echo: Building
    - sh: python build.py build --build=1
  # No test suite
  - install:
    - sh: |
        E="${KX_PREFIX}/lib/mozilla/extensions"
        mkdir -pv "$E"
        cp *.xpi "$E"
        cd "$E"
        mkdir \{d10d0bf8-f5b5-c8b4-a8b2-2b9879e08c5d\}
        cd \{d10d0bf8-f5b5-c8b4-a8b2-2b9879e08c5d\}
        unzip ../*.xpi
        chmod -R go+rX *

