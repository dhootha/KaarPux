From d7de665ca6ec69b2c268d7eb7e7b351b39fc64e8 Mon Sep 17 00:00:00 2001
From: Tim Waugh <twaugh@redhat.com>
Date: Thu, 11 Sep 2014 12:23:14 +0100
Subject: More use of subprocess.DEVNULL.


diff --git a/probe_printer.py b/probe_printer.py
index 6c1a7a3..d6dadf2 100644
--- a/probe_printer.py
+++ b/probe_printer.py
@@ -272,15 +272,14 @@ class PrinterFinder:
 
     def _probe_snmp (self):
         # Run the CUPS SNMP backend, pointing it at the host.
-        null = open ("/dev/null", "r+")
         try:
             debugprint ("snmp: trying")
             p = subprocess.Popen (args=["/usr/lib/cups/backend/snmp",
                                         self.hostname],
                                   close_fds=True,
-                                  stdin=null,
+                                  stdin=subprocess.DEVNULL,
                                   stdout=subprocess.PIPE,
-                                  stderr=null)
+                                  stderr=subprocess.DEVNULL)
         except OSError as e:
             debugprint ("snmp: no good")
             if e == errno.ENOENT:
@@ -365,14 +364,13 @@ class PrinterFinder:
                         self._cached_attributes['device-make-and-model'])
             return
 
-        null = open ("/dev/null", "r+")
         try:
             debugprint ("hplip: trying")
             p = subprocess.Popen (args=["hp-makeuri", "-c", self.hostname],
                                   close_fds=True,
-                                  stdin=null,
+                                  stdin=subprocess.DEVNULL,
                                   stdout=subprocess.PIPE,
-                                  stderr=null)
+                                  stderr=subprocess.DEVNULL)
         except OSError as e:
             if e == errno.ENOENT:
                 return
diff --git a/troubleshoot/CheckSELinux.py b/troubleshoot/CheckSELinux.py
index bcf2841..f7278b5 100644
--- a/troubleshoot/CheckSELinux.py
+++ b/troubleshoot/CheckSELinux.py
@@ -2,7 +2,7 @@
 
 ## Printing troubleshooter
 
-## Copyright (C) 2010 Red Hat, Inc.
+## Copyright (C) 2010, 2014 Red Hat, Inc.
 ## Copyright (C) 2010 Jiri Popelka <jpopelka@redhat.com>
 
 ## This program is free software; you can redistribute it and/or modify
@@ -48,7 +48,6 @@ class CheckSELinux(Question):
             return False
 
         paths = ["/etc/cups/", "/usr/lib/cups/", "/usr/share/cups/"]
-        null = open ("/dev/null", "r+")
         parent = self.troubleshooter.get_window ()
         contexts = {}
         new_environ = os.environ.copy()
@@ -60,9 +59,9 @@ class CheckSELinux(Question):
                                        args=restorecon_args,
                                        close_fds=True,
                                        env=new_environ,
-                                       stdin=null,
+                                       stdin=subprocess.DEVNULL,
                                        stdout=subprocess.PIPE,
-                                       stderr=null)
+                                       stderr=subprocess.DEVNULL)
             (restorecon_stdout, restorecon_stderr, result) = self.op.run ()
         except:
             # Problem executing command.
diff --git a/troubleshoot/VerifyPackages.py b/troubleshoot/VerifyPackages.py
index e25cf18..d3ca49e 100644
--- a/troubleshoot/VerifyPackages.py
+++ b/troubleshoot/VerifyPackages.py
@@ -2,7 +2,7 @@
 
 ## Printing troubleshooter
 
-## Copyright (C) 2010 Red Hat, Inc.
+## Copyright (C) 2010, 2014 Red Hat, Inc.
 ## Copyright (C) 2010 Jiri Popelka <jpopelka@redhat.com>
 
 ## This program is free software; you can redistribute it and/or modify
@@ -45,7 +45,6 @@ class VerifyPackages(Question):
                     "hpijs",
                     "hplip",
                     "system-config-printer"]
-        null = open ("/dev/null", "r+")
         parent = self.troubleshooter.get_window ()
 
         new_environ = os.environ.copy()
@@ -58,9 +57,9 @@ class VerifyPackages(Question):
                                            args=verification_args,
                                            close_fds=True,
                                            env=new_environ,
-                                           stdin=null,
+                                           stdin=subprocess.DEVNULL,
                                            stdout=subprocess.PIPE,
-                                           stderr=null)
+                                           stderr=subprocess.DEVNULL)
                 (verif_stdout, verif_stderr, result) = self.op.run ()
             except:
                 # Problem executing command.
diff --git a/userdefault.py b/userdefault.py
index 204b964..f80f984 100644
--- a/userdefault.py
+++ b/userdefault.py
@@ -75,8 +75,8 @@ class UserDefaultPrinter:
     def set (self, default):
         p = subprocess.Popen ([ "lpoptions", "-d", default ],
                               close_fds=True,
-                              stdin=open ("/dev/null"),
-                              stdout=open ("/dev/null", "w"),
+                              stdin=subprocess.DEVNULL,
+                              stdout=subprocess.DEVNULL,
                               stderr=subprocess.PIPE)
         (stdout, stderr) = p.communicate ()
         exitcode = p.wait ()
-- 
cgit v0.10.2

